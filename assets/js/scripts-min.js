window.addEventListener("load",(()=>{document.querySelector("#search-form").addEventListener("submit",(async e=>{e.preventDefault(),document.querySelector("#search_results_output").querySelectorAll("*").forEach((e=>e.remove()));let t=document.querySelector("#size-select").value,r=document.querySelector("#image_check").checked,c=document.querySelector("#search_query").value;const l=document.querySelector("#hint_search_query"),o=document.querySelector("#search_query");let a=!0;""===c||c.length<0?(l.classList.add("show-inline"),o.classList.add("input-error"),a=!1):(l.classList.remove("show-inline"),o.classList.remove("input-error")),a&&(document.querySelector("#search-form").classList.remove("show-block"),document.querySelector("#loading-view").classList.add("show-block"),fetch(`https://api.vam.ac.uk/v2/objects/search?q=${c}&page_size=${t}`+("null"===document.querySelector("#order_by").value?"":`&order_by=${document.querySelector("#order_by").value}`)+("null"===document.querySelector("#order_sort").value?"":`&order_sort=${document.querySelector("#order_sort").value}`)+`&images_exist=${r}&data_profile=full`).then((async e=>{if(e.ok)return await e.json();document.querySelector("#loading-view").classList.remove("show-block"),document.querySelector("#error-view").classList.add("show-block")})).then((e=>{const t=e.records,r=document.querySelector("#search_results_output");if(0===t.length){let e=document.createElement("div");e.classList.add("record_display");let t=document.createElement("h2");t.textContent="No records found",e.appendChild(t);let c=document.createElement("p");c.textContent="There are no records that match your search query",e.appendChild(c),r.appendChild(e)}else t.forEach((async e=>{let t=document.createElement("div");t.classList.add("record_display");let c=document.createElement("h2");c.textContent=`Record ${e.systemNumber}`,t.appendChild(c),await fetch(e._images._primary_thumbnail).then((async e=>{if(e.ok)return await e.blob()})).then((r=>{let c=document.createElement("img");c.src=URL.createObjectURL(r),c.alt=e._primaryTitle,t.appendChild(c);let l=document.createElement("div");l.classList.add("btn-container");let o=document.createElement("a");o.href=e._images._iiif_image_base_url+"/full/full/0/default.jpg",o.setAttribute("target","_blank"),o.setAttribute("rel","noopener noreferrer"),o.classList.add("record_link","btn"),o.textContent="View full image",l.appendChild(o),t.appendChild(l)})).catch((e=>{let r=document.createElement("img");r.src="assets/images/no-image-available.png",r.alt="No image available",r.classList.add("error-image"),t.appendChild(r)}));let l=document.createElement("h3");l.textContent="Title:",t.appendChild(l);let o=document.createElement("p");o.textContent=`${""===e._primaryTitle?"No title":e._primaryTitle}`,t.appendChild(o);let a=document.createElement("h3");a.textContent="Date:",t.appendChild(a);let n=document.createElement("p");n.textContent=`${""===e._primaryDate?"No date":e._primaryDate}`,t.appendChild(n);let s=document.createElement("h3");s.textContent="Summary description:",t.appendChild(s);let d=document.createElement("p");d.textContent=`${""===e.summaryDescription?"No description available":e.summaryDescription.replaceAll(/<[^>]*>?/gm,"")}`,t.appendChild(d);let i=document.createElement("div");i.classList.add("btn-container");let u=document.createElement("a");u.href="http://collections.vam.ac.uk/item/"+e.systemNumber,u.setAttribute("target","_blank"),u.setAttribute("rel","noopener noreferrer"),u.classList.add("record_link","btn"),u.textContent="View V&A Collection Record",i.appendChild(u),t.appendChild(i),r.appendChild(t)}));document.querySelector("#loading-view").classList.remove("show-block"),document.querySelector("#search-results").classList.add("show-block")})).catch((e=>{document.querySelector("#loading-view").classList.remove("show-block"),document.querySelector("#error-view").classList.add("show-block")})))})),document.querySelector("#try-again").addEventListener("click",(e=>{e.preventDefault(),document.querySelector("#error-view").classList.remove("show-block"),document.querySelector("#search-form").classList.add("show-block")})),document.querySelector("#back-to-search").addEventListener("click",(e=>{e.preventDefault(),document.querySelector("#search_query").value="",document.querySelector("#search-results").classList.remove("show-block"),document.querySelector("#search-form").classList.add("show-block")}))}));